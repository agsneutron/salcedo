{% extends "admin/base_site.html" %}
{% load i18n admin_static app_filters %}
{% block content %}


    <div class="col-xs-12" style="margin-bottom: 25px">
        <div class="card">
            <div class="card-block text-center">
                <div class="row">
                <span class="ms-icon ms-icon-circle ms-icon mb-4 color-info" style="margin-bottom: 0rem !important"><i
                        class="zmdi zmdi-city-alt"></i></span>
                    <h3 class="color-info">
                        Estimación<a href="/admin/ERP/estimate/{{ estimate.id }}/change/">
                        <i class="fa fa-pencil color-default eliminar"></i>
                    </a>
                    </h3>

                    <br>
                    <div class="col-xs-12">
                        <div class="col-xs-12 col-sm-8 text-left">
                            <div style="padding-top: 10px;">
                                <dl>
                                    <dt>Clave del Contrato:</dt>
                                    <dd style="padding-top: 4px">{{ estimate.contract.clave_contrato }}</dd>
                                    <dt>Contratista:</dt>
                                    <dd style="padding-top: 4px"> {{ estimate.contract.contratista.nombreContratista }}</dd>
                                    <dt>Partida:</dt>
                                    <dd style="padding-top: 4px">{{ estimate.contract.line_item.description }}</dd>
                                    <dt>Monto del Contrato:</dt>
                                    <dd style="padding-top: 4px">{{ estimate.contract.monto_contrato }}</dd>
                                    <dt>Monto Actual:</dt>
                                    <dd style="padding-top: 4px">{{ estimate.contract_amount_override }}</dd>

                                    <hr>

                                </dl>

                                <div class="">
                                    {% if estimate.advance_payment_amount > 0 %}
                                        <div class="col-xs-12 col-sm-3  text-center"><strong
                                                class="color-active">Adelanto: </strong>{{ estimate.advance_payment_amount|formatoNumero }}
                                        </div>
                                        <div class="col-xs-12 col-sm-6  text-center"><strong
                                                class="color-active">Fecha: </strong>{{ estimate.advance_payment_date }}
                                        </div>
                                        <div class="col-xs-12 col-sm-3  text-center"><strong
                                                class="color-active">Estado: </strong>{{ estimate.get_advance_payment_status_display }}
                                        </div>
                                    {% elif estimate.advance_payment_amount == 0 %}
                                        <div>No se ha definido un anticipo</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>


                        <div class="col-xs-12 col-sm-4  text-left">
                            <div style="    padding-top: 52px;">
                                <dl>

                                    <dd>Periodo</dd>
                                    <dt>{{ estimate.end_date }}</dt>
                                    <hr>
                                    <dd>Fecha Inicio</dd>
                                    <dt>{{ estimate.start_date }}</dt>
                                    <hr>
                                    <dd>Fecha Final</dd>
                                    <dt>{{ estimate.end_date }}</dt>

                                </dl>
                            </div>
                        </div>

                    </div>
                    <div class="clearfix"></div>
                    <hr>
                    <div class="col-xs-12 text-left">

                        <div class="card card-default">
                            <div class="card-header">
                                <h3 class="card-title">
                                    Avances
                                </h3>
                            </div>
                            <div class="item-right">
                                <a href="/admin/ERP/progressestimate/add/?estimate={{ estimate.id }}"
                                   class="btn-circle btn-circle-sm btn-circle-raised btn-circle-success icon-container">
                                    &nbsp; <i class="zmdi zmdi-plus zmdi-hc-2x center-icon"></i>
                                </a>

                            </div>

                            {% if progress_estimates %}
                                <div class="card-block text-center">
                                    <div class="table-responsive">
                                        <table id="table_s" class="table table-striped text-center">
                                            <thead>
                                            <tr>
                                                <th class="text-center">Clave de la Estimación</th>
                                                <th class="text-center">Progreso</th>
                                                <th class="text-center">Monto</th>
                                                <th class="text-center">Estatus del Pago</th>
                                                <th class="text-center">Archivo del Generador</th>
                                                <th class="text-center no-sorting" >Editar</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                {% for progress_estimate in progress_estimates %}
                                                    <tr class="text-center">
                                                        <td>
                                                            {{ progress_estimate.key }}
                                                        </td>
                                                        <td>
                                                            <div class="progress" id="progressbar">
                                                                <div class="progress-bar progress-bar-{% if progress_estimate.progress|slice:":-1"  < 15 %}danger
                                                                  {% elif progress_estimate.progress|slice:":-1" > 15 and progress_estimate.progress|slice:":-1" < 50 %}warning
                                                                  {% elif progress_estimate.progress|slice:":-1" >= 50 and progress_estimate.progress|slice:":-1" <= 75 %}info
                                                                  {% elif progress_estimate.progress|slice:":-1" > 75 %}success
                                                                  {% endif %}"
                                                                     role="progressbar"
                                                                     aria-valuenow="{{ progress_estimate.progress }}"
                                                                     aria-valuemin="0" aria-valuemax="100"
                                                                     style="width: {{ progress_estimate.progress }}">
                                                                </div>

                                                            </div>
                                                            <small>{{ progress_estimate.progress }}</small>

                                                        </td>
                                                        <td>
                                                            {{ progress_estimate.amount }}
                                                        </td>
                                                        <td>
                                                            {{ progress_estimate.get_payment_status_display }}
                                                        </td>
                                                        <td>
                                                            {% if progress_estimate.generator_file %}
                                                                <a href="/media/{{ progress_estimate.generator_file }}"
                                                                   download
                                                                   class="btn btn-raised btn-default btn-xs">
                                                                    <i class="fa fa-cloud-download fa-2x color-info eliminar"></i>
                                                                </a>
                                                            {% endif %}

                                                        </td>
                                                        <td class="text-center" style="width: 2%">
                                                            <a href="/admin/ERP/progressestimate/{{ progress_estimate.id }}/change/"
                                                               class="btn btn-raised btn-default btn-xs"><i
                                                                    class="fa fa-pencil color-default eliminar"></i></a>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            {% else %}
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;No se ha agregado ningún avance.</div>
                            {% endif %}
                        </div>


                    </div>
                </div>


            </div>
        </div>
    </div>
    <script>
        {% comment %}var progressBarColor;

        var someValueToCheck = {{ progress_estimate.progress }};

        if(someValueToCheck >= 4) progressBarColor = "#ff0000";
        else if(someValueToCheck >=5) progressBarColor = "orange";
        else progressBarColor = "green";

        $("#progressbar").css('background-color', progressBarColor);{% endcomment %}
    </script>




    <div>
        <table border="1">
        <tr>
            <td>Key</td>
            <td>Descripción</td>
            <td>Cantidad Pactada</td>
        </tr>
            {% for c in contract_concepts %}
                <tr>
                    <td width="10%">{{ c.concept.key }}</td>
                    <td>{{ c.concept.description }}</td>
                    <td>{{ c.amount }}</td>
                </tr>
            {% endfor %}
        </table>
    </div>

{% endblock %}