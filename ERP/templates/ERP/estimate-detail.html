{% extends "admin/base_site.html" %}
{% load i18n admin_static app_filters %}
{% block content %}


    <div class="col-xs-12" style="margin-bottom: 25px">
        <div class="card">
            <div class="card-block text-center">
                <div class="row">
                <span class="ms-icon ms-icon-circle ms-icon mb-4 color-info" style="margin-bottom: 0rem !important"><i
                        class="zmdi zmdi-city-alt"></i></span>
                    <h3 class="color-info">
                        Estimación&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="/admin/ERP/estimate/{{ estimate.id }}/change/">
                        <i class="fa fa-pencil color-default eliminar"></i>
                    </a>
                    </h3>

                    <div class="col-xs-12 col-sm-6 text-left">

                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Clave del Contrato:</span> {{ estimate.contract.clave_contrato }}</span>
                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Contratista:</span> {{ estimate.contract.contratista.nombreContratista }}</span>
                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Monto del Contrato:</span> {{ estimate.contract.monto_contrato }}</span>
                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Monto Actual:</span> {{ estimate.contract_amount_override }}</span>
                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Partida:</span> {{ estimate.contract.line_item.description }}</span>
                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i>{% comment %} <span
                                class="color-active">Ver Conceptos<span class="glyphicon glyphicon-chevron-down"></span> </span> {% endcomment %}


                        <span href="#" class="color-active exp" data-toggle="collapse" data-target="#verconceptos">
                            Ver Conceptos <span class="glyphicon  glyphicon-plus-sign"></span> </span>
                            <br>
                    </div>

                    <div class="col-xs-12 col-sm-6 text-left">

                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Adelanto:</span> {{ estimate.advance_payment_amount|formatoNumero }}</span>
                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Fecha:</span> {{ estimate.advance_payment_date }}</span>
                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Estado:</span> {{ estimate.get_advance_payment_status_display }}</span>
                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Periodo:</span> {{ estimate.end_date }}</span>
                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Fecha Inicio:</span> {{ estimate.start_date }}</span>
                        <span href="" class="list-group-item withripple "><i
                                class="fa fa-chevron-right color-active"></i> <span
                                class="color-active">Fecha Final:</span> {{ estimate.end_date }}</span>
                    </div>
                    <div class="col-xs-12">
                       {% comment %} <div class="col-xs-12 col-sm-4 text-left">
                            <div style="padding-top: 10px;">
                                <dl>
                                    <dt>Clave del Contrato:</dt>
                                    <dd style="padding-top: 4px">{{ estimate.contract.clave_contrato }}</dd>
                                    <hr>
                                    <dt>Contratista:</dt>
                                    <dd style="padding-top: 4px"> {{ estimate.contract.contratista.nombreContratista }}</dd>
                                     <hr>
                                    <dt>Monto del Contrato:</dt>
                                    <dd style="padding-top: 4px">{{ estimate.contract.monto_contrato }}</dd>
                                     <hr>
                                    <dt>Monto Actual:</dt>
                                    <dd style="padding-top: 4px">{{ estimate.contract_amount_override }}</dd>
                                     <dt>Partida:</dt>
                                    <dd style="padding-top: 4px">{{ estimate.contract.line_item.description }}</dd>

                                </dl>


                            </div>
                        </div>
{% endcomment %}
                       {% comment %} <div class="col-xs-12 col-sm-4  text-left">
                            <div style="padding-top: 12px;">
                                <dl>
                                    {% if estimate.advance_payment_amount > 0 %}
                                        <dd>Adelanto: </dd>
                                            <dt>{{ estimate.advance_payment_amount|formatoNumero }}</dt>
                                        <hr>
                                        <dd>Fecha:  </dd>
                                            <dt>{{ estimate.advance_payment_date }}</dt>
                                        <hr>
                                        <dd>Estado: </dd>
                                            <dt>{{ estimate.get_advance_payment_status_display }}</dt>

                                    {% elif estimate.advance_payment_amount == 0 %}
                                        <dd>No se ha definido un anticipo</dd>

                                    {% endif %}
                                </dl>

                            </div>
                        </div>

                        <div class="col-xs-12 col-sm-4  text-left">
                            <div style="padding-top: 12px;">
                                <dl>

                                    <dd>Periodo</dd>
                                    <dt>{{ estimate.end_date }}</dt>
                                    <hr>
                                    <dd>Fecha Inicio</dd>
                                    <dt>{{ estimate.start_date }}</dt>
                                    <hr>
                                    <dd>Fecha Final</dd>
                                    <dt>{{ estimate.end_date }}</dt>

                                </dl>
                            </div>
                        </div>

                    </div>{% endcomment %}
                    <div class="clearfix"></div>


                    {% comment %}begin concepts{% endcomment %}
                     <div id="verconceptos" class="collapse">
                        <table border="1">
                        <tr>
                            <td>Key</td>
                            <td>Descripción</td>
                            <td>Cantidad Pactada</td>
                        </tr>
                            {% for c in contract_concepts %}
                                <tr>
                                    <td width="10%">{{ c.concept.key }}</td>
                                    <td>{{ c.concept.description }}</td>
                                    <td>{{ c.amount }}</td>
                                </tr>
                            {% endfor %}
                        </table>
                    <hr>
                    </div>
                    {% comment %}end concepts{% endcomment %}

                     <div class="clearfix"></div>
                    <div class="col-xs-12 text-left">

                        <div class="card card-default">
                            <div class="card-header">
                                <h3 class="card-title">
                                    Avances
                                </h3>
                            </div>
                            <div class="item-right">
                                <a href="/admin/ERP/progressestimate/add/?estimate={{ estimate.id }}"
                                   class="btn-circle btn-circle-sm btn-circle-raised btn-circle-success icon-container">
                                    &nbsp; <i class="zmdi zmdi-plus zmdi-hc-2x center-icon"></i>
                                </a>

                            </div>

                            {% if progress_estimates %}
                                <div class="card-block text-center">
                                    <div class="table-responsive">
                                        <table id="table_s" class="table table-striped text-center">
                                            <thead>
                                            <tr>
                                                <th class="text-center">Clave de la Estimación</th>
                                                <th class="text-center">Progreso</th>
                                                <th class="text-center">Monto</th>
                                                <th class="text-center">Estatus del Pago</th>
                                                <th class="text-center">Archivo del Generador</th>
                                                <th class="text-center no-sorting" >Editar</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr>
                                                {% for progress_estimate in progress_estimates %}
                                                    <tr class="text-center">
                                                        <td>
                                                            {{ progress_estimate.key }}
                                                        </td>
                                                        <td>
                                                            <div class="progress" id="progressbar">
                                                                <div class="progress-bar progress-bar-{% if progress_estimate.progress|slice:":-1"  < 15 %}danger
                                                                  {% elif progress_estimate.progress|slice:":-1" > 15 and progress_estimate.progress|slice:":-1" < 50 %}warning
                                                                  {% elif progress_estimate.progress|slice:":-1" >= 50 and progress_estimate.progress|slice:":-1" <= 75 %}info
                                                                  {% elif progress_estimate.progress|slice:":-1" > 75 %}success
                                                                  {% endif %}"
                                                                     role="progressbar"
                                                                     aria-valuenow="{{ progress_estimate.progress }}"
                                                                     aria-valuemin="0" aria-valuemax="100"
                                                                     style="width: {{ progress_estimate.progress }}">
                                                                </div>

                                                            </div>
                                                            <small>{{ progress_estimate.progress }}</small>

                                                        </td>
                                                        <td>
                                                            {{ progress_estimate.amount }}
                                                        </td>
                                                        <td>
                                                            {{ progress_estimate.get_payment_status_display }}
                                                        </td>
                                                        <td>
                                                            {% if progress_estimate.generator_file %}
                                                                <a href="/media/{{ progress_estimate.generator_file }}"
                                                                   download
                                                                   class="btn btn-raised btn-default btn-xs">
                                                                    <i class="fa fa-cloud-download fa-2x color-info eliminar"></i>
                                                                </a>
                                                            {% endif %}

                                                        </td>
                                                        <td class="text-center" style="width: 2%">
                                                            <a href="/admin/ERP/progressestimate/{{ progress_estimate.id }}/change/"
                                                               class="btn btn-raised btn-default btn-xs"><i
                                                                    class="fa fa-pencil color-default eliminar"></i></a>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            {% else %}
                                <div>&nbsp;&nbsp;&nbsp;&nbsp;No se ha agregado ningún avance.</div>
                            {% endif %}
                        </div>


                    </div>
                </div>


            </div>
        </div>
    </div>
    <script>
        {% comment %}var progressBarColor;

        var someValueToCheck = {{ progress_estimate.progress }};

        if(someValueToCheck >= 4) progressBarColor = "#ff0000";
        else if(someValueToCheck >=5) progressBarColor = "orange";
        else progressBarColor = "green";

        $("#progressbar").css('background-color', progressBarColor);{% endcomment %}
    </script>

<script>
$(document).ready(function(){
  $("#verconceptos").on("hide.bs.collapse", function(){
    $(".exp").html(' Ver Conceptos <span class="glyphicon glyphicon-plus-sign"></span>');
  });
  $("#verconceptos").on("show.bs.collapse", function(){
    $(".exp").html(' Ver Conceptos <span class="glyphicon glyphicon-minus-sign"></span>');
  });
});
</script>



{% endblock %}